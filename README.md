# TPA Commands Mod

一个为Necesse游戏添加TPA命令的模组。

**项目仓库**: [https://github.com/Shuazijun/TPA-Commands](https://github.com/Shuazijun/TPA-Commands)

## 项目概述

- **模组ID**: `shuazi.tpa.commands`
- **模组名称**: `TPA Commands`
- **模组版本**: `1.5`
- **目标游戏版本**: `1.0.1`
- **模组描述**: `为游戏添加TPA和传送点命令`
- **作者**: `Shuazi`
- **客户端模式**: `false` (需要服务器支持)

## 功能特性

### 传送系统
- **/tpa [玩家名]** - 请求传送到另一个玩家
- **/tpac [玩家名]** - 接受特定玩家的传送请求（点对点）
- **/tpad [玩家名]** - 拒绝特定玩家的传送请求（点对点）
- **/tpac** - 接受所有待处理传送请求（批量）
- **/tpad** - 拒绝所有待处理传送请求（批量）
- **/传送请求 [玩家名]** - 请求传送到另一个玩家（中文命令）
- **/同意传送 [玩家名]** - 接受特定玩家的传送请求（点对点，中文命令）
- **/拒绝传送 [玩家名]** - 拒绝特定玩家的传送请求（点对点，中文命令）
- **/同意传送** - 接受所有待处理传送请求（批量，中文命令）
- **/拒绝传送** - 拒绝所有待处理传送请求（批量，中文命令）

### 返回系统 (v1.1 新增)
- **/back** - 返回上一个坐标点（优先死亡位置，其次传送前位置）
- **/backcd [秒数]** - 设置返回冷却时间（管理员专用，默认15秒）
- **/返回** - 返回上一个坐标点（中文命令）
- **/设置返回冷却时间 [秒数]** - 设置返回冷却时间（管理员专用，中文命令）

### 传送点系统 (v1.1 新增)
- **/newwarp [传送点名称]** - 在当前位置创建传送点（管理员专用，支持home、spawn、town、base等预设名称）
- **/delwarp [传送点名称]** - 删除指定传送点（管理员专用）
- **/warp [传送点名称]** - 传送到指定传送点（默认冷却15秒）
- **/warplist** - 查看所有可用传送点列表
- **/warpcd [秒数]** - 设置传送点冷却时间（管理员专用，默认15秒）
- **/新建传送点 [传送点名称]** - 在当前位置创建传送点（管理员专用，中文命令）
- **/删除传送点 [传送点名称]** - 删除指定传送点（管理员专用，中文命令）
- **/传送点 [传送点名称]** - 传送到指定传送点（中文命令）
- **/传送点列表** - 查看所有可用传送点列表（中文命令）
- **/设置传送点冷却时间 [秒数]** - 设置传送点冷却时间（管理员专用，中文命令）

### 随机传送系统 (v1.5 新增)
- **/rtp** - 随机传送到当前关卡的随机位置（默认冷却15秒）
- **/rtpcd [秒数]** - 设置随机传送冷却时间（管理员专用，默认15秒）
- **/rtplimit [范围]** - 设置随机传送范围限制（管理员专用，默认1000像素，最小100像素，无上限）
- **/随机传送** - 随机传送到当前关卡的随机位置（中文命令）
- **/设置随机传送冷却时间 [秒数]** - 设置随机传送冷却时间（管理员专用，中文命令）
- **/设置随机传送范围 [范围]** - 设置随机传送范围限制（管理员专用，中文命令）

### 坐标查询和传送 (v1.2 增强)
- **/getpos [玩家名]** - 获取玩家位置和关卡信息（管理员可查询其他玩家）
- **/tppos [x坐标] [y坐标] [关卡标识符] [玩家名]** - 传送到指定坐标和关卡（管理员专用，支持跨维度传送）
- **/获取坐标 [玩家名]** - 获取玩家位置和关卡信息（管理员可查询其他玩家，中文命令）
- **/传送坐标 [x坐标] [y坐标] [关卡标识符] [玩家名]** - 传送到指定坐标和关卡（管理员专用，中文命令）

### 传送系统管理
- **/tpacd [秒数]** - 设置TPA请求冷却时间（管理员专用，默认15秒）
- **/设置传送请求冷却时间 [秒数]** - 设置TPA请求冷却时间（管理员专用，中文命令）

## 使用说明

### 返回系统
**管理员命令**:
```
/backcd [秒数] - 设置返回冷却时间（1-3600秒，默认15秒）
/设置返回冷却时间 [秒数] - 设置返回冷却时间（中文命令）
```

**玩家命令**:
```
/back - 返回上一个坐标点（优先死亡位置，其次传送前位置）
/返回 - 返回上一个坐标点（中文命令）
```

### 传送点系统
**管理员命令**:
```
/newwarp [传送点名称] - 在当前位置创建传送点（支持home、spawn、town、base等预设名称）
/delwarp [传送点名称] - 删除指定传送点
/warpcd [秒数] - 设置传送点冷却时间（1-3600秒，默认15秒）
/新建传送点 [传送点名称] - 在当前位置创建传送点（中文命令）
/删除传送点 [传送点名称] - 删除指定传送点（中文命令）
/设置传送点冷却时间 [秒数] - 设置传送点冷却时间（中文命令）
```

**玩家命令**:
```
/warp [传送点名称] - 传送到指定传送点（有冷却时间，默认15秒）
/warplist - 查看所有可用传送点列表
/传送点 [传送点名称] - 传送到指定传送点（中文命令）
/传送点列表 - 查看所有可用传送点列表（中文命令）
```

### 随机传送系统 (v1.5 新增)
**玩家命令**:
```
/rtp - 随机传送到当前关卡的随机位置（有冷却时间，默认15秒）
/随机传送 - 随机传送到当前关卡的随机位置（中文命令）
```

**管理员命令**:
```
/rtpcd [秒数] - 设置随机传送冷却时间（1-3600秒，默认15秒）
/设置随机传送冷却时间 [秒数] - 设置随机传送冷却时间（中文命令）
```

### 坐标查询和传送 (v1.2 新增跨维度功能)
**管理员命令**:
```
/getpos [玩家名] - 获取玩家位置和关卡信息（可查询其他玩家）
/tppos [x坐标] [y坐标] [关卡标识符] - 传送到指定坐标和关卡
/tppos [x坐标] [y坐标] [关卡标识符] [玩家名] - 将其他玩家传送到指定坐标和关卡
/获取坐标 [玩家名] - 获取玩家位置和关卡信息（中文命令）
/传送坐标 [x坐标] [y坐标] [关卡标识符] - 传送到指定坐标和关卡（中文命令）
/传送坐标 [x坐标] [y坐标] [关卡标识符] [玩家名] - 将其他玩家传送到指定坐标和关卡（中文命令）
```

**玩家命令**:
```
/getpos - 获取自己当前位置和关卡信息
/获取坐标 - 获取自己当前位置和关卡信息（中文命令）
```

### 跨维度传送功能 (v1.2 新增)
现在支持真正的跨维度传送，可以直接使用关卡标识符：
```
/tppos 100 200 surface - 传送到地表坐标(100,200)
/tppos 300 400 cave - 传送到地下洞穴坐标(300,400)
/tppos 500 600 deepcave - 传送到深层洞穴坐标(500,600)
/tppos 700 800 flat_chromakeypink - 传送到平坦世界坐标(700,800)
```

所有关卡标识符都支持游戏自动补全功能，无需记忆硬编码的维度编号。

### 传送系统
**玩家间传送**:
```
/tpa [玩家名] - 发送传送请求（有冷却时间，默认15秒）
/tpac [玩家名] - 接受特定玩家的传送请求（点对点）
/tpad [玩家名] - 拒绝特定玩家的传送请求（点对点）
/tpac - 接受所有待处理传送请求（批量）
/tpad - 拒绝所有待处理传送请求（批量）
/tpacd [秒数] - 设置TPA请求冷却时间（管理员专用）
/传送请求 [玩家名] - 发送传送请求（中文命令）
/同意传送 [玩家名] - 接受特定玩家的传送请求（点对点，中文命令）
/拒绝传送 [玩家名] - 拒绝特定玩家的传送请求（点对点，中文命令）
/同意传送 - 接受所有待处理传送请求（批量，中文命令）
/拒绝传送 - 拒绝所有待处理传送请求（批量，中文命令）
/设置传送请求冷却时间 [秒数] - 设置TPA请求冷却时间（管理员专用，中文命令）
```

## 冷却时间配置
所有传送相关功能都有冷却时间保护，默认设置为15秒：
- TPA请求冷却时间：15秒
- 传送点使用冷却时间：15秒
- 返回命令冷却时间：15秒
- 随机传送冷却时间：15秒

管理员可以使用相应的配置命令调整冷却时间（1-3600秒）。

## 技术改进 (v1.5)
- **随机传送系统**：新增 `/rtp` 和 `/随机传送` 命令，在当前关卡内随机传送
- **随机传送冷却**：普通玩家默认15秒冷却，管理员和所有者不受限制
- **可配置范围限制**：新增 `/rtplimit` 命令设置随机传送范围（最小100像素，无上限）
- **安全位置检查**：自动寻找安全的传送位置，避免传送到危险区域
- **配置文件统一**：所有配置文件使用 `.dat` 格式，统一命名规范
- **完整群系信息支持**：所有传送系统现在都记录和显示真实的群系信息
- **传送点群系存储**：传送点创建时自动记录当前群系，传送时显示目标群系
- **返回系统群系记录**：返回命令记录传送前和死亡时的真实群系信息
- **坐标查询群系显示**：GetPos命令显示当前位置的完整群系信息
- **所有者权限支持**：服务器所有者现在拥有与管理员相同的权限
- **权限工具类**：创建统一的权限检查工具类，简化权限管理
- **点对点传送响应**：支持 `/tpac 玩家名` 和 `/tpad 玩家名` 精确同意/拒绝特定玩家的请求
- **防止请求冲突**：每个目标玩家只能有一个待处理请求，防止多个玩家同时请求导致混乱
- **代码清理**：移除配置文件中的未使用参数，优化存储效率
- **移除硬编码维度映射**：不再使用数字0、1、2表示维度，直接使用LevelIdentifier API
- **真正的跨维度传送**：使用changeLevel API实现异步关卡切换
- **自动补全支持**：所有关卡标识符都支持游戏自动补全
- **代码优化**：清理了过时的岛屿坐标系统，优化import语句

## 许可证

本项目基于以下开源项目构建：
- [ExampleMod](https://github.com/Shuazijun/ExampleMod) - 框架模板（仅作为开发参考）
- [Necesse-Teleports-Extended](https://github.com/deadly990/Necesse-Teleports-Extended) - 传送功能（仅作为功能参考）

## 贡献

欢迎提交问题和拉取请求来改进这个模组。

## 联系方式

如有问题或建议，请通过GitHub Issues联系：[TPA Commands Issues](https://github.com/Shuazijun/TPA-Commands/issues)